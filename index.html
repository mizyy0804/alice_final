<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Modern Alice</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Griffy&display=swap" rel="stylesheet">

    <style>
        /* [í°íŠ¸] ë¡œì»¬ íŒŒì¼ (ZEN-SERIF-Regular.otf) ì—°ê²° */
        @font-face {
            font-family: 'ZenSerif';
            src: url('./ZEN-SERIF-Regular.otf') format('opentype');
            font-weight: normal;
            font-display: swap;
        }

        /* í°íŠ¸ ì„¤ì •: ì˜ë¬¸ì€ Griffy, í•œê¸€ì€ ZenSerif ì ìš© */
        body { font-family: 'Griffy', 'ZenSerif', serif; }

        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* ê¸°ë³¸ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes spin-slow-reverse { from { transform: rotate(360deg); } to { transform: rotate(0deg); } }
        @keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }
        @keyframes gradient-xy { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }
        @keyframes fade-in-up { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* ë‹¨ìˆœ ìƒ‰ë°˜ì „ íš¨ê³¼ */
        .invert-hover { transition: filter 0.1s ease; }
        .invert-hover:hover { filter: invert(1); }

        /* í…ìŠ¤íŠ¸ ë°˜ì§ì„ íš¨ê³¼ */
        @keyframes text-twinkle {
            0%, 100% { opacity: 1; text-shadow: 0 0 10px #FF148A, 0 0 20px #FF148A; transform: scale(1); }
            50% { opacity: 0.6; text-shadow: 0 0 2px #FF148A, 0 0 5px #FF148A; transform: scale(0.98); }
        }
        .animate-twinkle { animation: text-twinkle 2s ease-in-out infinite; }

        /* ì•„ì´ì½˜ í”ë“¤ë¦¼ íš¨ê³¼ */
        @keyframes icon-shake {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(3deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-3deg); }
            100% { transform: rotate(0deg); }
        }
        .hover-shake:hover .icon-container {
            animation: icon-shake 0.3s infinite linear;
        }

        /* ë‘¥ì‹¤ë‘¥ì‹¤ íš¨ê³¼ (Floating) */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        /* ë°˜ì§ì´(Sparkle) íš¨ê³¼ */
        @keyframes sparkle-float {
            0% { transform: translateY(0) scale(0.5); opacity: 0; }
            50% { opacity: 1; transform: translateY(-10px) scale(1.2); }
            100% { transform: translateY(-20px) scale(0.5); opacity: 0; }
        }
        .animate-sparkle {
            animation: sparkle-float 3s ease-in-out infinite;
        }

        /* í™”ë ¤í•œ ì˜¤ë¡œë¼ ì›¨ì´ë¸Œ ë°°ê²½ íš¨ê³¼ */
        @keyframes aurora-wave {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .bg-aurora {
            background: linear-gradient(-45deg, #35C8FF, #FF148A, #FFFF00, #35C8FF);
            background-size: 400% 400%;
            animation: aurora-wave 6s ease infinite;
            opacity: 0.6;
            mix-blend-mode: overlay;
        }

        /* [NEW] í´ë¦­ ì‹œ ë– ì˜¤ë¥´ëŠ” ìˆ«ì íš¨ê³¼ */
        @keyframes float-up-fade {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.5); opacity: 0; }
        }
        .animate-float-text {
            animation: float-up-fade 0.8s ease-out forwards;
        }

        /* [NEW] í•˜íŠ¸ ê³ ë™ì¹˜ëŠ” íš¨ê³¼ */
        @keyframes heart-beat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .animate-heart-beat {
            animation: heart-beat 0.8s ease-in-out infinite;
        }

        /* ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤ */
        .animate-spin-slow { animation: spin-slow 8s linear infinite; }
        .animate-spin-slow-reverse { animation: spin-slow-reverse 8s linear infinite; }
        .animate-marquee { animation: marquee 15s linear infinite; }
        .animate-gradient-xy { background-size: 200% 200%; animation: gradient-xy 3s ease infinite; }
        .animate-fade-in-up { animation: fade-in-up 0.5s ease-out forwards; }
        body.hide-cursor { cursor: none; }
        .bg-win95 {
            background-image: linear-gradient(#fff 1px, transparent 1px), linear-gradient(90deg, #fff 1px, transparent 1px);
            background-size: 40px 40px;
        }
    </style>
</head>
<body class="text-white overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        /* --- ì•„ì´ì½˜ í—¬í¼ --- */
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => { if (window.lucide) window.lucide.createIcons(); }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        /* =========================================
           [COMPONENT] Alice Portrait
           ========================================= */
        const AlicePortrait = ({ faceId = 1, visible = true }) => {
            if (!visible) return null;
            return (
                <img 
                    src={`./alice_face${faceId}.webp`} 
                    alt="Alice Character"
                    className="fixed bottom-0 right-[5%] max-h-[60vh] w-auto z-[10000] pointer-events-none animate-fade-in-up drop-shadow-2xl"
                />
            );
        };

        /* =========================================
           [COMPONENT] Dialogue Box
           ========================================= */
        const DialogueBox = ({ text, onClick, showCursor = true }) => (
            <div 
                className="fixed bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/95 to-transparent pt-32 pb-8 px-8 flex flex-col justify-end z-[9999] cursor-pointer min-h-[30vh]"
                onClick={onClick}
            >
                <div className="self-start bg-pink-600 text-white text-xl px-4 py-1 rounded-t-lg font-bold mb-1 animate-fade-in-up tracking-widest font-[Griffy]">
                    Alice
                </div>
                <div className="w-full bg-black/80 border border-gray-700 rounded-b-lg rounded-tr-lg p-6 relative shadow-lg animate-fade-in-up">
                    <p className="text-white text-xl leading-relaxed tracking-wide font-['ZenSerif'] pb-6">{text}</p>
                    
                    {/* ì•ˆë‚´ ë¬¸êµ¬ */}
                    {showCursor && (
                        <div className="absolute bottom-2 left-1/2 -translate-x-1/2 text-gray-500 text-sm font-[Griffy] tracking-wider animate-pulse opacity-70 whitespace-nowrap">
                            â–¼ í´ë¦­í•´ì„œ ë„˜ì–´ê°€ì„¸ìš”
                        </div>
                    )}
                </div>
            </div>
        );

        /* =========================================
           [GLOBAL] CUSTOM CURSOR
           ========================================= */
        const CustomCursor = ({ visible }) => {
            const cursorRef = useRef(null);
            useEffect(() => {
                const moveCursor = (e) => {
                    if (cursorRef.current) {
                        cursorRef.current.style.left = `${e.clientX}px`;
                        cursorRef.current.style.top = `${e.clientY}px`;
                    }
                };
                if (visible) { document.body.classList.add('hide-cursor'); window.addEventListener('mousemove', moveCursor); }
                else { document.body.classList.remove('hide-cursor'); }
                return () => { window.removeEventListener('mousemove', moveCursor); document.body.classList.remove('hide-cursor'); };
            }, [visible]);
            if (!visible) return null;
            return (
                <img ref={cursorRef} src="./cursor.gif" onError={(e) => {e.target.src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExazF5eWpjYTJ5Z3J5eWpjYTJ5Z3J5eWpjYTJ5Z3J5eWpjYTJ5Z3J5eWpjYTJ5ZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/l0Exk8EUzSLsrErEQ/giphy.gif"}} alt="Custom Cursor" className="fixed pointer-events-none z-[9999] w-[150px] h-auto transform -translate-x-1/2 -translate-y-1/2 transition-transform duration-100 ease-out hidden sm:block" style={{ left: '-100px', top: '-100px' }} />
            );
        };

        /* =========================================
           [SCENE 0] INTRO
           ========================================= */
        const IntroScene = ({ onNext }) => {
            const [isStarted, setIsStarted] = useState(false);
            const [dialogueStep, setDialogueStep] = useState(0);
            
            const dialogues = [
                "ì˜¤ëŠ˜ë„... ì•„ë¬´ ì¼ë„ ì—†ì—ˆë„¤.",
                "ì§€ë£¨í•´. ë­”ê°€ ì¬ë¯¸ìˆëŠ” ê±° ì—†ì„ê¹Œ?",
                "(ìŠ¤ë§ˆíŠ¸í° í™”ë©´ì´ ë°˜ì§ì¸ë‹¤)"
            ];

            const handleStartClick = (e) => { e.stopPropagation(); setIsStarted(true); };
            const handleDialogueClick = () => {
                if (dialogueStep < dialogues.length - 1) setDialogueStep(dialogueStep + 1);
                else onNext();
            };

            return (
                <div 
                    className="relative w-full h-full flex flex-col items-center justify-center cursor-pointer" 
                    onClick={isStarted ? handleDialogueClick : undefined}
                    style={{
                        backgroundImage: isStarted ? "url('./intro_room.webp')" : "none",
                        backgroundSize: "cover",
                        backgroundPosition: "center"
                    }}
                >
                    {!isStarted && (
                        <>
                            <img src="./main_alice.webp" alt="Alice Start" className="w-full h-auto max-w-screen-lg max-h-[85vh] object-contain transition-all duration-200 invert-hover drop-shadow-2xl relative z-10" />
                            <div className="absolute bottom-[12%] z-20 flex flex-col items-center gap-2">
                                <button onClick={handleStartClick} className="text-[#FF148A] text-5xl md:text-6xl cursor-pointer hover:text-white transition-colors animate-twinkle font-[Griffy]" style={{ textShadow: '0 0 10px rgba(255, 20, 138, 0.5)' }}>
                                    CLICK TO START
                                </button>
                            </div>
                        </>
                    )}
                    {isStarted && (
                        <>
                            <AlicePortrait faceId={1} visible={true} />
                            {dialogueStep < dialogues.length && (
                                <DialogueBox text={dialogues[dialogueStep]} onClick={handleDialogueClick} />
                            )}
                        </>
                    )}
                </div>
            );
        };

        /* =========================================
           [SCENE 1] HUB
           ========================================= */
        const HubScene = ({ onSelectRoom, visitedRooms }) => {
            const [loading, setLoading] = useState(true);
            
            // í—ˆë¸Œ ë…ë°±
            const getThought = () => {
                if (visitedRooms.size === 0) return "ì–´ë””ë¥¼ ë¨¼ì € ë‘˜ëŸ¬ë³¼ê¹Œ? ë‹¤ ì¬ë°Œì–´ ë³´ì´ëŠ”ë°...";
                if (visitedRooms.size === 1) return "ì‹œê°„ ê°€ëŠ” ì¤„ ëª¨ë¥´ê² ë„¤. ë‹¤ìŒì€ ì–´ë””ì§€?";
                if (visitedRooms.size === 2) return "ì•„ì§ ì•ˆ ê°€ë³¸ ê³³ì´ í•˜ë‚˜ ë‚¨ì•˜ì–´.";
                return "ì´ì œ ë‹¤ ë³¸ ê±´ê°€? ...ì•„ë‹ˆì•¼, ë­”ê°€ ë¶€ì¡±í•´.";
            };

            // ëœë¤ ë°˜ì§ì´ ìƒì„±
            const [sparkles, setSparkles] = useState([]);
            useEffect(() => {
                const newSparkles = Array.from({ length: 20 }).map((_, i) => ({
                    id: i,
                    left: Math.random() * 100 + '%',
                    top: Math.random() * 100 + '%',
                    delay: Math.random() * 2 + 's',
                    duration: Math.random() * 2 + 2 + 's',
                    size: Math.random() * 20 + 10 + 'px'
                }));
                setSparkles(newSparkles);
            }, []);

            // ì•± ì‹¤í–‰ ì‹œ ëŒ€ì‚¬ ì²˜ë¦¬
            const [pendingRoom, setPendingRoom] = useState(null);
            const [dialogueText, setDialogueText] = useState("");

            const handleRoomClick = (id) => {
                let text = "";
                if (id === 'shorts') text = "ì‡¼ì¸ ëŠ” ì •ë§ ì¢‹ì•„. ê·¸ëƒ¥ ê³„ì† ìŠ¤í¬ë¡¤í•˜ì...ì§ˆë¦´ë•Œê¹Œì§€.";
                else if (id === 'meme') text = "ìš”ì¦˜ ìµœì‹  ë°ˆì€ ë¬´ì¡°ê±´ ì•Œê³  ìˆì–´ì•¼ì§€.";
                else if (id === 'shopping') text = "ê°œì¸ì •ë³´ê°€ ë„˜ì–´ê°„ë‹¤ëŠ” ì†Œë¬¸ì´ ìˆë˜ë°... ëª¨ë¥´ê² ê³ . ì¼ë‹¨ ëŒë ¤ë³¼ê¹Œ?";
                else if (id === 'clicker') text = "ì•„ë¬´ ìƒê° ì—†ì´ ëˆ„ë¥´ê¸°ë§Œ í•˜ë©´ ë¼. ì´ê²Œ íë§ì´ì§€..."; // í´ë¦¬ì»¤ ëŒ€ì‚¬

                setDialogueText(text);
                setPendingRoom(id);
            };

            const handleDialogueClick = () => {
                if (pendingRoom) {
                    onSelectRoom(pendingRoom);
                    setPendingRoom(null);
                }
            };

            useEffect(() => { const timer = setTimeout(() => setLoading(false), 2000); return () => clearTimeout(timer); }, []);

            if (loading) {
                return (
                    <div className="w-full h-full bg-black flex flex-col items-center justify-center overflow-hidden relative">
                        {/* ë¹™ê¸€ë¹™ê¸€ í…Œë‘ë¦¬ + ì•„ì´ì½˜ í¬ê¸° 2ë°°(w-64) */}
                        <div className="relative w-64 h-64 flex items-center justify-center z-10">
                            <div className="absolute inset-0 w-full h-full border-8 border-dashed border-pink-500 rounded-full animate-spin-slow"></div>
                            <img src="./loading.gif" className="w-full h-full object-cover rounded-full p-1" alt="loading" />
                        </div>
                        <p className="text-pink-500 font-mono mt-8 animate-pulse tracking-widest z-10">FALLING INTO THE FEED...</p>
                        
                        {/* ë ˆì´ì € íš¨ê³¼ ë°°ê²½ */}
                        <div className="absolute inset-0 bg-[conic-gradient(from_0deg,transparent_0_340deg,#ff007a_360deg)] opacity-40 animate-spin-slow pointer-events-none"></div>
                    </div>
                );
            }

            return (
                <div className="w-full h-full bg-[#35C8FF] relative overflow-hidden flex flex-col items-center justify-center">
                    
                    <div className="absolute inset-0 bg-aurora pointer-events-none"></div>
                    <div className="absolute inset-0 bg-[radial-gradient(circle,transparent_40%,rgba(0,0,0,0.3)_100%)] pointer-events-none"></div>

                    {/* ë‘¥ì‹¤ë‘¥ì‹¤ ë°˜ì§ì´ ì´í™íŠ¸ */}
                    <div className="absolute inset-0 pointer-events-none z-0">
                        {sparkles.map(s => (
                            <div 
                                key={s.id} 
                                className="absolute text-white opacity-80 animate-sparkle"
                                style={{ 
                                    left: s.left, 
                                    top: s.top, 
                                    fontSize: s.size, 
                                    animationDelay: s.delay, 
                                    animationDuration: s.duration,
                                    textShadow: '0 0 10px #fff'
                                }}
                            >
                                âœ¦
                            </div>
                        ))}
                    </div>

                    {/* ìŠ¤ë§ˆíŠ¸í° ìƒë‹¨ë°” */}
                    <div className="absolute top-0 w-full px-6 py-3 flex justify-between items-center text-white z-50 font-['ZenSerif'] opacity-90">
                        <span className="text-lg font-bold">03:00</span>
                        <div className="flex gap-3">
                            <Icon name="signal" size={18} />
                            <Icon name="wifi" size={18} />
                            <Icon name="battery-full" size={18} />
                        </div>
                    </div>

                    <h2 className="text-white text-3xl text-center mb-8 z-10 drop-shadow-[0_0_10px_rgba(255,255,255,0.8)] tracking-widest font-[Griffy] animate-pulse">CHOOSE YOUR POISON!!</h2>
                    
                    {/* 2x2 ê·¸ë¦¬ë“œ (4ê°œ ì•„ì´ì½˜) */}
                    <div className="grid grid-cols-2 gap-x-12 gap-y-8 z-10 w-full px-10 mb-20 place-items-center">
                        <RoomButton id="shorts" title="Time-Killer" imgSrc="./btn_shorts.webp" badge="99+" onClick={handleRoomClick} visited={visitedRooms.has('shorts')} />
                        <RoomButton id="meme" title="Cup of Meme" imgSrc="./btn_meme.webp" badge="N" onClick={handleRoomClick} visited={visitedRooms.has('meme')} />
                        <RoomButton id="shopping" title="Live Shop" imgSrc="./btn_shopping.webp" badge="1" onClick={handleRoomClick} visited={visitedRooms.has('shopping')} />
                        {/* 4ë²ˆì§¸ ì•±: Love Addiction */}
                        <RoomButton id="clicker" title="Love Addiction" imgSrc="./btn_like.webp" badge="â™¥" onClick={handleRoomClick} visited={visitedRooms.has('clicker')} />
                    </div>

                    <AlicePortrait faceId={1} visible={true} />
                    <DialogueBox 
                        text={pendingRoom ? dialogueText : getThought()} 
                        onClick={pendingRoom ? handleDialogueClick : undefined} 
                        showCursor={true}
                    />
                </div>
            );
        };

        const RoomButton = ({ id, title, imgSrc, badge, onClick, visited }) => (
            <button onClick={() => onClick(id)} className="group relative flex flex-col items-center justify-center w-auto hover-shake">
                <div className="icon-container relative w-32 h-32 rounded-[2rem] transition-transform duration-200 group-hover:scale-110 drop-shadow-2xl shadow-black/50">
                    <img src={imgSrc} alt={title} className={`w-full h-full object-cover rounded-[2rem] ${visited ? 'opacity-60 grayscale' : ''}`} />
                    {!visited && (
                        <div className="absolute -top-3 -right-3 bg-red-600 text-white text-sm font-bold w-10 h-10 flex items-center justify-center rounded-full border-2 border-white shadow-lg animate-bounce z-20 font-[Griffy] tracking-tighter">
                            {badge}
                        </div>
                    )}
                    {visited && (
                        <div className="absolute top-0 right-0 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-bl-xl z-20 font-[Griffy]">
                            âœ“
                        </div>
                    )}
                </div>
                <span className={`mt-3 text-lg text-center font-[Griffy] leading-tight ${visited ? 'text-gray-600' : 'text-white'} group-hover:text-pink-500 transition-colors drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)]`}>
                    {title}
                </span>
            </button>
        );

        /* =========================================
           [DATA] ROOM TRANSITION INFO
           ========================================= */
        const ROOM_INFO = {
            shorts: { id: 'shorts', img: './btn_shorts.webp', text: "ë¬´í•œí•œ ìˆí¼ì˜ êµ´ë ˆì— ëª¸ì„ ë§¡ê²¨ë³´ì„¸ìš”." },
            meme: { id: 'meme', img: './btn_meme.webp', text: "ì˜ë¯¸ ì—†ëŠ” ë°ˆê³¼ ë…¸ì´ì¦ˆì˜ ë°”ë‹¤ë¡œ..." },
            shopping: { id: 'shopping', img: './btn_shopping.webp', text: "ê±°ë¶€í•  ìˆ˜ ì—†ëŠ” ì†Œë¹„ì˜ ìœ í˜¹ ì†ìœ¼ë¡œ..." },
            clicker: { id: 'clicker', img: './btn_like.webp', text: "ë‹¹ì‹ ì˜ ê´€ì‹¬ì„ ëŠì„ì—†ì´ ê°ˆêµ¬í•©ë‹ˆë‹¤." }
        };

        const VIDEO_POOL = [
            { id: 1, type: "file", username: "alice_lisa", description: "ì´ê²Œ ë§ì•„? ğŸŒ€ #wasterland", music: "Original Sound - Alice", likes: "1.2K", comments: "402", shares: "125", videoUrl: "./shorts_01.mp4", userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Alice" },
            { id: 2, type: "file", username: "mukbang_king", description: "ì•¼ì‹ ì°¸ê¸° LV.99 ğŸ”", music: "Yummy - Cooking BGM", likes: "854K", comments: "2.1K", shares: "5.2K", videoUrl: "./shorts_02.mp4", userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Cook" },
            { id: 3, type: "file", username: "puppy_lover", description: "ê·€ì—¬ì›€ í•œë„ì´ˆê³¼ ğŸ¶", music: "Happy Dog - BGM World", likes: "2.5M", comments: "10K", shares: "45K", videoUrl: "./shorts_03.mp4", userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Buster" },
            { id: 4, type: "file", username: "dev_daily", description: "ê°œë°œì í˜„ì‹¤ ì½”ë”© ğŸ’» #error", music: "Lo-Fi Beats", likes: "12K", comments: "532", shares: "1.1K", videoUrl: "./shorts_04.mp4", userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Dev" },
            { id: 5, type: "file", username: "travel_vlog", description: "íë§ë˜ëŠ” í’ê²½ ğŸŒŠ #ocean", music: "Ocean Waves", likes: "450K", comments: "3.4K", shares: "12K", videoUrl: "./shorts_05.mp4", userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Travel" },
            { id: 6, type: "file", username: "satisfying_asmr", description: "ë§ˆìŒì´ í¸ì•ˆí•´ì§€ëŠ” ì˜ìƒ ğŸ¨", music: "Colors - Art BGM", likes: "98K", comments: "890", shares: "2.3K", videoUrl: "./shorts_06.mp4", userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Art" },
            { id: 7, type: "file", username: "dance_challenge", description: "ìš”ì¦˜ ìœ í–‰í•˜ëŠ” ì±Œë¦°ì§€ ğŸ’ƒ", music: "Trending Pop", likes: "1.1M", comments: "5K", shares: "20K", videoUrl: "./shorts_07.mp4", userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Dance" }
        ];

        /* [SCENE 2] SHORTS ROOM */
        const ShortsRoom = () => {
            const [videos, setVideos] = useState(VIDEO_POOL);
            const [isMuted, setIsMuted] = useState(true);
            const [showEntryDialogue, setShowEntryDialogue] = useState(true);
            const observerRef = useRef(null);
            const videoRefs = useRef([]);
            const loadMore = useCallback(() => { setVideos(prev => [...prev, ...VIDEO_POOL.sort(() => Math.random() - 0.5)]); }, []);
            
            useEffect(() => {
                const handleIntersection = (entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const index = Number(entry.target.dataset.index);
                            const currentVideo = videoRefs.current[index];
                            if (currentVideo) { currentVideo.muted = isMuted; currentVideo.currentTime = 0; currentVideo.play().catch(e => console.log("ìë™ ì¬ìƒ ë§‰í˜")); }
                            videoRefs.current.forEach((vid, idx) => { if (idx !== index && vid) vid.pause(); });
                            if (index === videos.length - 1) loadMore();
                        }
                    });
                };
                const observer = new IntersectionObserver(handleIntersection, { threshold: 0.6 });
                const slides = document.querySelectorAll('.video-slide');
                slides.forEach(slide => observer.observe(slide));
                return () => observer.disconnect();
            }, [videos, loadMore, isMuted]);
            useEffect(() => { videoRefs.current.forEach(video => { if (video) video.muted = isMuted; }); }, [isMuted]);

            return (
                <div className="w-full h-full bg-black overflow-y-scroll scrollbar-hide snap-y snap-mandatory relative">
                    {/* [ìˆ˜ì •] ì†Œë¦¬ ë²„íŠ¼: absolute, ìŠ¤íƒ€ì¼ ê°•í™” */}
                    <div className="absolute top-0 left-0 w-full z-20 pointer-events-none p-4">
                        <span className="absolute top-4 left-1/2 -translate-x-1/2 text-xl shadow-black drop-shadow-md flex items-center gap-1 font-[Griffy] text-white/80">
                            Shorts <Icon name="search" size={20} />
                        </span>
                        <button 
                            onClick={() => setIsMuted(!isMuted)} 
                            className="absolute top-4 right-4 pointer-events-auto bg-black/60 backdrop-blur-md p-2 rounded-full border border-white/50 text-white transition-all hover:bg-white hover:text-pink-500 hover:shadow-[0_0_20px_rgba(255,255,255,0.8)] hover:scale-110"
                        >
                            {isMuted ? <Icon name="volume-x" size={24} /> : <Icon name="volume-2" size={24} />}
                        </button>
                    </div>

                    {videos.map((video, index) => (
                        <div key={`${video.id}-${index}`} data-index={index} className="video-slide w-full h-full snap-center relative flex items-center justify-center bg-gray-900 border-b border-gray-800">
                            {video.type === 'file' ? <video ref={el => videoRefs.current[index] = el} src={video.videoUrl} className="w-full h-full object-cover" muted={isMuted} loop playsInline /> : <div className="text-white">Video Load Error</div>}
                            <div className="absolute right-2 bottom-20 flex flex-col items-center gap-6 z-10 text-white">
                                <div className="w-12 h-12 rounded-full bg-gray-700 p-[1px] overflow-hidden border border-white"><img src={video.userAvatar} className="w-full h-full object-cover"/></div>
                                <div className="flex flex-col items-center gap-1 cursor-pointer hover:text-pink-500 transition-colors"><Icon name="heart" size={32} fill="rgba(255,255,255,0.2)" /> <span className="text-sm font-[Griffy]">{video.likes}</span></div>
                                <div className="flex flex-col items-center gap-1"><Icon name="message-circle" size={32} /><span className="text-sm font-[Griffy]">{video.comments}</span></div>
                                <div className="flex flex-col items-center gap-1"><Icon name="share-2" size={32} /><span className="text-sm font-[Griffy]">{video.shares}</span></div>
                            </div>
                            <div className="absolute left-0 bottom-0 w-full p-4 bg-gradient-to-t from-black/80 to-transparent text-white z-10">
                                <div className="flex items-center gap-2 mb-2"><span className="text-xl font-bold font-[Griffy]">@{video.username}</span> <span className="text-blue-400 text-sm px-2 border border-blue-400 rounded font-['ZenSerif']">íŒ”ë¡œìš°</span></div>
                                <p className="text-lg mb-2 font-['ZenSerif']">{video.description}</p>
                                <div className="flex items-center gap-2 text-sm opacity-80 animate-marquee whitespace-nowrap overflow-hidden w-1/2"><Icon name="music" size={16} /> <span className="font-[Griffy]">{video.music}</span></div>
                            </div>
                        </div>
                    ))}

                    {/* ì…ì¥ ëŒ€ì‚¬ */}
                    {showEntryDialogue && (
                        <>
                            <AlicePortrait faceId={1} visible={true} />
                            <DialogueBox text="ì‡¼ì¸ ëŠ” ì •ë§ ì¢‹ì•„. ê·¸ëƒ¥ ê³„ì† ìŠ¤í¬ë¡¤í•˜ì...ì§ˆë¦´ë•Œê¹Œì§€." onClick={() => setShowEntryDialogue(false)} />
                        </>
                    )}
                </div>
            );
        };

        /* [SCENE 3] MEME ROOM */
        const MemeRoom = () => {
            const clickSound = useRef(new Audio('./error.mp3'));
            const [popups, setPopups] = useState([]);
            const [pedroSpin, setPedroSpin] = useState(false);
            const [dogFire, setDogFire] = useState(false);
            const [catConfused, setCatConfused] = useState(false);
            const [showEntryDialogue, setShowEntryDialogue] = useState(true);

            const playClickSound = () => { clickSound.current.currentTime = 0; clickSound.current.play().catch(() => {}); };
            const triggerPopup = (title, text) => {
                playClickSound();
                const id = Date.now() + Math.random();
                const x = Math.random() * 40 + 10; const y = Math.random() * 60 + 10; 
                setPopups(prev => [...prev, { id, title, text, x, y }]);
                setTimeout(() => setPopups(prev => prev.filter(p => p.id !== id)), 2000);
            };
            const handleStartClick = () => {
                playClickSound();
                for(let i=0; i<5; i++) setTimeout(() => triggerPopup("SYSTEM ERROR", "CRITICAL FAILURE!"), i * 100);
            };

            return (
                <div className="w-full h-full bg-[#008080] flex flex-col relative overflow-hidden font-[System,sans-serif]">
                    <div className="absolute inset-0 opacity-20 pointer-events-none bg-win95"></div>
                    <div className="bg-[#000080] p-1 flex items-center justify-between shadow-md z-50">
                        <div className="flex items-center gap-2 text-white text-sm font-[Griffy]"><Icon name="monitor" size={16} /> Meme_Explorer.exe</div>
                        <div className="flex gap-1">
                            <button className="w-4 h-4 bg-[#c0c0c0] border-2 border-white border-b-black border-r-black flex items-center justify-center" onClick={playClickSound}><Icon name="minimize-2" size={10}/></button>
                            <button className="w-4 h-4 bg-[#c0c0c0] border-2 border-white border-b-black border-r-black flex items-center justify-center" onClick={playClickSound}><Icon name="maximize-2" size={10}/></button>
                            <button className="w-4 h-4 bg-[#c0c0c0] border-2 border-white border-b-black border-r-black flex items-center justify-center text-xs" onClick={playClickSound}>X</button>
                        </div>
                    </div>
                    <div className="flex-1 relative">
                        <div onClick={() => { setPedroSpin(true); triggerPopup("Raccoon.exe", "Pedro Pedro ğŸ¦ğŸ”„"); setTimeout(() => setPedroSpin(false), 1000); }} className="absolute top-[20%] right-[10%] w-32 bg-[#c0c0c0] border-2 border-white border-b-black border-r-black shadow-xl cursor-pointer active:border-black active:border-b-white active:border-r-white flex flex-col items-center p-1">
                             <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExejVtbW91bTRrNGh6emZveHc1b3Z3cGl1bGlyZGdrZjV0a2YxanFmZyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/aQwvKKi4Lv3t63nZl9/giphy.gif" className={`w-24 h-24 object-cover border-2 border-gray-500 bg-white ${pedroSpin ? 'animate-spin' : ''}`} alt="pedro" />
                             <span className="text-black text-[10px] mt-1 font-bold">Pedro.gif</span>
                        </div>
                        <div onClick={() => { setDogFire(true); triggerPopup("Dog_Logic.dll", "This is fine. ğŸ”¥"); setTimeout(() => setDogFire(false), 2000); }} className="absolute top-[45%] left-[10%] w-36 bg-[#c0c0c0] border-2 border-white border-b-black border-r-black shadow-xl cursor-pointer hover:scale-105 transition-transform flex flex-col items-center p-1">
                             <div className="relative w-full h-28 bg-white border-2 border-gray-500 overflow-hidden">
                                 <img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExa2JidGlmNWtmcHBnbndhdGZwNzdsNnAzZ3M3N3F3Ym9sdjh2bWhiNCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/QMHoU66sBXqqLqYvGO/giphy.gif" className="w-full h-full object-cover" alt="dog" />
                             </div>
                             <span className="text-black text-[10px] mt-1 font-bold">Fine.exe</span>
                        </div>
                        <div onClick={() => { setCatConfused(true); triggerPopup("System Error", "What??? ğŸ˜¿"); setTimeout(() => setCatConfused(false), 500); }} className="absolute bottom-[15%] left-1/2 -translate-x-1/2 w-32 bg-[#c0c0c0] border-2 border-white border-b-black border-r-black shadow-xl cursor-pointer flex flex-col items-center p-1">
                             <img src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExNTFsc2xkMnVuOGRkOXpjODIwdm54Nnk1ang4aG10bzRjZHdhNzlqbSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/wr7oA0rSjnWuiLJOY5/giphy.gif" className={`w-24 h-20 object-cover border-2 border-gray-500 bg-white ${catConfused ? 'translate-x-1 -translate-y-1' : ''}`} alt="cat" />
                             <div className="mt-1"><button className="px-2 py-0.5 text-[10px] border border-black shadow bg-gray-200 active:bg-gray-400 text-black">OK</button></div>
                        </div>
                        {popups.map((p) => (
                            <div key={p.id} className="absolute z-50 bg-[#ffffe0] border border-black px-2 py-1 text-sm shadow-[4px_4px_0px_rgba(0,0,0,1)] font-mono animate-in zoom-in duration-200 text-black" style={{ top: `${p.y}%`, left: `${p.x}%` }}>
                                <div className="flex items-center gap-1 text-blue-800 font-bold mb-1 border-b border-black/20 pb-1"><Icon name="info" size={10} /> {p.title}</div>
                                <div className="pt-1 font-bold">{p.text}</div>
                            </div>
                        ))}
                    </div>
                    <div className="h-8 bg-[#c0c0c0] border-t-2 border-white flex items-center px-2 gap-1">
                        <button onClick={handleStartClick} className="flex items-center gap-1 px-2 py-0.5 bg-[#c0c0c0] border-2 border-white border-b-black border-r-black shadow active:border-black active:border-t-black active:bg-gray-400">
                            <img src="https://win98icons.alexmeub.com/icons/png/windows-0.png" className="w-4 h-4" alt="start"/><span className="text-xs font-bold text-black">Start</span>
                        </button>
                        <div className="flex-1"></div>
                        <div className="px-2 py-0.5 border-2 border-gray-500 border-b-white border-r-white bg-gray-200 text-xs text-black">3:00 AM</div>
                    </div>
                    {showEntryDialogue && (
                        <>
                            <AlicePortrait faceId={1} visible={true} />
                            <DialogueBox text="ìš”ì¦˜ ìµœì‹  ë°ˆì€ ë¬´ì¡°ê±´ ì•Œê³  ìˆì–´ì•¼ì§€." onClick={() => setShowEntryDialogue(false)} />
                        </>
                    )}
                </div>
            );
        };

        /* [SCENE 4] SHOPPING ROULETTE */
        const ShoppingRoulette = () => {
            const [isSpinning, setIsSpinning] = useState(false);
            const [rotation, setRotation] = useState(0);
            const [showPopup, setShowPopup] = useState(false);
            const [showCardForm, setShowCardForm] = useState(false);
            const [isProcessing, setIsProcessing] = useState(false);
            const [showError, setShowError] = useState(false);
            const [showPostErrorDialogue, setShowPostErrorDialogue] = useState(false);
            const [showEntryDialogue, setShowEntryDialogue] = useState(true);
            const [cartCount, setCartCount] = useState(0);
            const [items, setItems] = useState([
                { id: 1, name: "Limited Ed. Bag", price: "â‚©500,000", color: "bg-red-500" },
                { id: 2, name: "Magic Diet Pills", price: "â‚©5,000", color: "bg-blue-500" },
                { id: 3, name: "Lucky Charm", price: "â‚©29,900", color: "bg-purple-500" },
            ]);

            const handleSpin = () => {
                if (isSpinning) return;
                setIsSpinning(true);
                setRotation(rotation + 1800 + Math.random() * 30 + 20);
                setTimeout(() => { setIsSpinning(false); setShowPopup(true); }, 3000);
            };
            const handleSubmitCard = () => {
                setIsProcessing(true);
                setTimeout(() => { setIsProcessing(false); setShowCardForm(false); setShowPopup(false); setShowError(true); setShowPostErrorDialogue(true); }, 2000);
            };
            const resetRoom = () => { setShowError(false); setRotation(0); setShowPostErrorDialogue(false); };
            const addToCart = () => { setCartCount(prev => prev + 1); };

            return (
                <div className="w-full h-full bg-[#FF5000] flex flex-col overflow-hidden relative items-center font-sans">
                    <div className="absolute top-14 right-4 z-20 bg-white text-black px-3 py-2 rounded-full font-bold border-2 border-black shadow-md flex items-center gap-2 font-['ZenSerif']">
                        <Icon name="shopping-bag" size={20}/> <span className="text-lg">{cartCount}</span>
                    </div>
                    <div className="absolute top-0 left-0 w-full z-30 bg-black/80 text-yellow-400 text-xl py-1 overflow-hidden whitespace-nowrap">
                        <div className="animate-marquee inline-block font-['ZenSerif']">ğŸ‰ ê¹€*ì§€ë‹˜ì´ ì•„ì´í° 15 Proì— ë‹¹ì²¨ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰ ì´*í˜ë‹˜ì´ 500,000ì› ì¿ í°ì„ ë°›ì•˜ìŠµë‹ˆë‹¤!</div>
                    </div>
                    <div className="flex-1 flex flex-col items-center p-4 w-full overflow-y-auto pb-20 pt-16">
                        <h1 className="text-5xl text-white italic transform -rotate-2 mt-2 mb-6 drop-shadow-lg font-[Griffy]">LUCKY SPIN</h1>
                        <div className="relative w-64 h-64 mb-6 shrink-0">
                            <div className="absolute top-0 left-1/2 -translate-x-1/2 -translate-y-4 z-20 w-0 h-0 border-x-[15px] border-x-transparent border-t-[30px] border-t-yellow-400"></div>
                            <div className="w-full h-full rounded-full border-8 border-yellow-400 bg-white overflow-hidden transition-transform duration-[3000ms] cubic-bezier(0.2, 0.8, 0.2, 1)" style={{ transform: `rotate(${rotation}deg)` }}>
                                <div className="absolute inset-0" style={{ background: `conic-gradient(#f00 0deg 60deg, #fff 60deg 120deg, #f00 120deg 180deg, #fff 180deg 240deg, #f00 240deg 300deg, #fff 300deg 360deg)` }}></div>
                                <div className="absolute inset-0 flex items-center justify-center"><div className="w-16 h-16 bg-yellow-400 rounded-full flex items-center justify-center text-red-600 border-4 border-white z-10 text-2xl font-[Griffy]">SPIN</div></div>
                            </div>
                        </div>
                        <button onClick={handleSpin} disabled={isSpinning} className="w-full py-3 rounded-full bg-yellow-400 text-red-600 text-2xl shadow-lg animate-pulse mb-6 shrink-0 font-['ZenSerif'] font-bold">
                            {isSpinning ? 'ì¶”ì²¨ ì¤‘...' : 'ë¬´ë£Œë¡œ ëŒë¦¬ê¸°!'}
                        </button>
                        <div className="w-full space-y-3">
                             {items.map(item => (
                                <div key={item.id} className="w-full bg-white rounded-lg p-3 shadow-lg text-black flex items-center border-b-4 border-gray-300 transform hover:scale-105 transition-transform">
                                    <div className={`w-14 h-14 ${item.color} rounded-md mr-3 shadow-inner`}></div>
                                    <div className="flex-1">
                                        <p className="font-bold text-lg font-['ZenSerif'] leading-tight">{item.name}</p>
                                        <span className="text-red-600 font-bold text-sm">{item.price}</span>
                                    </div>
                                    <button onClick={addToCart} className="bg-[#FF5000] text-white text-sm px-4 py-2 rounded-full font-bold active:scale-95 transition-transform shadow-md font-['ZenSerif']">
                                        + ë‹´ê¸°
                                    </button>
                                </div>
                             ))}
                        </div>
                    </div>
                    {showPopup && !showCardForm && !showError && (
                        <div className="absolute inset-0 z-50 bg-black/80 flex items-center justify-center p-4 animate-in fade-in">
                            <div className="bg-white w-full rounded-xl p-6 border-4 border-yellow-400 relative text-center shadow-2xl text-black">
                                <button onClick={() => setShowPopup(false)} className="absolute top-2 right-2 text-gray-300 hover:text-gray-500"><Icon name="x" size={16}/></button>
                                <Icon name="gift" className="w-12 h-12 text-red-500 mx-auto mb-2 animate-bounce" />
                                <h2 className="text-3xl text-gray-900 font-['ZenSerif'] font-bold">500,000ì› ë‹¹ì²¨!</h2>
                                <div className="bg-gray-100 p-3 rounded my-4"><p className="text-sm text-gray-500 font-['ZenSerif']"><Icon name="alert-circle" size={12} className="inline mr-1"/> ì¶œê¸ˆê¹Œì§€ <span className="text-red-500 font-bold">100ì›</span> ë¶€ì¡±í•©ë‹ˆë‹¤.</p></div>
                                <button onClick={() => setShowCardForm(true)} className="w-full bg-[#FF5000] text-white py-3 rounded-lg text-2xl flex items-center justify-center font-['ZenSerif'] font-bold">ì§€ê¸ˆ ì±„ìš°ê¸° <Icon name="chevron-right" size={24}/></button>
                            </div>
                        </div>
                    )}
                    {showCardForm && !isProcessing && (
                        <div className="absolute inset-0 z-50 bg-black/90 flex items-center justify-center p-4 animate-in slide-in-from-bottom text-black">
                            <div className="bg-white w-full rounded-xl p-6 relative">
                                <button onClick={() => setShowCardForm(false)} className="absolute top-2 right-2"><Icon name="x" size={20}/></button>
                                <h3 className="text-2xl mb-4 flex items-center font-['ZenSerif'] font-bold"><Icon name="credit-card" className="mr-2 text-[#FF5000]"/> ë³¸ì¸ ì¸ì¦</h3>
                                <input placeholder="ì¹´ë“œ ë²ˆí˜¸" className="w-full border p-3 rounded mb-2 text-xl outline-none focus:border-[#FF5000] font-['ZenSerif']"/>
                                <div className="flex gap-2 mb-4"><input placeholder="MM/YY" className="w-1/2 border p-3 rounded text-xl outline-none focus:border-[#FF5000] font-['ZenSerif']"/><input placeholder="CVC" className="w-1/2 border p-3 rounded text-xl outline-none focus:border-[#FF5000] font-['ZenSerif']"/></div>
                                <button onClick={handleSubmitCard} className="w-full bg-black text-white py-3 rounded-lg text-2xl hover:bg-gray-800 transition-colors font-['ZenSerif'] font-bold">ì¸ì¦í•˜ê³  ë°›ê¸°</button>
                            </div>
                        </div>
                    )}
                    {isProcessing && (
                        <div className="absolute inset-0 z-50 bg-black/90 flex flex-col items-center justify-center text-white">
                            <Icon name="refresh-cw" className="w-12 h-12 animate-spin mb-4 text-[#FF5000]" />
                            <p className="text-2xl animate-pulse font-['ZenSerif']">ê²°ì œ ìŠ¹ì¸ ì¤‘...</p>
                            <p className="text-sm text-gray-400 mt-2 font-['ZenSerif']">ì„œë²„ì™€ ì—°ê²°í•˜ê³  ìˆìŠµë‹ˆë‹¤</p>
                        </div>
                    )}
                    {showError && (
                        <div className="absolute inset-0 z-50 bg-white flex flex-col items-center justify-center p-6 text-center animate-in zoom-in duration-200 text-black">
                            <Icon name="alert-circle" className="w-16 h-16 text-red-600 mb-4" />
                            <h2 className="text-4xl text-red-600 mb-2 font-[Griffy]">ERROR 404</h2>
                            <p className="text-gray-800 text-xl mb-1 font-['ZenSerif'] font-bold">ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                            <p className="text-sm text-gray-500 mb-6 font-['ZenSerif']">ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ë¶ˆì•ˆì •í•˜ê±°ë‚˜ ì”ì•¡ì´ ë¶€ì¡±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                            <button onClick={resetRoom} className="bg-black text-white px-6 py-3 rounded-lg text-xl font-['ZenSerif'] font-bold">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                        </div>
                    )}
                    {showEntryDialogue && (
                        <>
                            <AlicePortrait faceId={1} visible={true} />
                            <DialogueBox text="ê°œì¸ì •ë³´ê°€ ë„˜ì–´ê°„ë‹¤ëŠ” ì†Œë¬¸ì´ ìˆë˜ë°... ëª¨ë¥´ê² ê³ . ì¼ë‹¨ ëŒë ¤ë³¼ê¹Œ?" onClick={() => setShowEntryDialogue(false)} />
                        </>
                    )}
                    {showPostErrorDialogue && (
                        <>
                            <AlicePortrait faceId={1} visible={true} />
                            <DialogueBox text="ì•„ë‹ˆ ì™œ ë˜ ì•ˆëœë‹¤ëŠ”ê±°ì•¼? ë‹¤ ì…ë ¥í–ˆëŠ”ë° ì§œì¦ë‚˜ê²Œ..." onClick={() => setShowPostErrorDialogue(false)} />
                        </>
                    )}
                </div>
            );
        };

        /* [NEW] SCENE: LOVE ADDICTION (CLICKER) - DARK SNS STYLE */
        const ClickerRoom = () => {
            const [score, setScore] = useState(0);
            const [floatingTexts, setFloatingTexts] = useState([]);
            const [showEntryDialogue, setShowEntryDialogue] = useState(true);
            const [clickPower, setClickPower] = useState(1);
            const [autoClicker, setAutoClicker] = useState(0);
            // const clickSound = useRef(new Audio('./error.mp3')); // í•„ìš”ì‹œ ì£¼ì„ í•´ì œ

            const upgrades = [
                { id: 1, name: "ë§¤í¬ë¡œ ëŒë¦¬ê¸°", cost: 50, power: 1, type: 'auto' },
                { id: 2, name: "ì–´ê·¸ë¡œ ëŒê¸°", cost: 200, power: 5, type: 'click' },
                { id: 3, name: "ê°€ê³„ì • êµ¬ë§¤", cost: 500, power: 10, type: 'auto' },
            ];

            useEffect(() => {
                const interval = setInterval(() => {
                    if (autoClicker > 0) {
                        setScore(prev => prev + autoClicker);
                    }
                }, 1000);
                return () => clearInterval(interval);
            }, [autoClicker]);

            const handleClick = (e) => {
                // clickSound.current.currentTime = 0; clickSound.current.play().catch(()=>{}); // ì‚¬ìš´ë“œ í•„ìš”ì‹œ
                setScore(prev => prev + clickPower);
                const id = Date.now();
                const rect = e.target.getBoundingClientRect();
                const x = e.clientX - rect.left + (Math.random() * 40 - 20); 
                const y = e.clientY - rect.top + (Math.random() * 40 - 20);
                setFloatingTexts(prev => [...prev, { id, x, y, text: `+${clickPower}` }]);
                setTimeout(() => setFloatingTexts(prev => prev.filter(ft => ft.id !== id)), 800);
            };

            const buyUpgrade = (upgrade) => {
                if (score >= upgrade.cost) {
                    setScore(prev => prev - upgrade.cost);
                    if (upgrade.type === 'click') setClickPower(prev => prev + upgrade.power);
                    else setAutoClicker(prev => prev + upgrade.power);
                }
            };

            return (
                <div className="w-full h-full bg-gray-900 flex flex-col relative overflow-hidden font-sans">
                    {/* Fake SNS Header Bar */}
                    <div className="w-full bg-gray-800 p-3 flex justify-between items-center border-b border-gray-700 z-10">
                        <div className="flex items-center gap-2">
                            <div className="w-8 h-8 bg-pink-600 rounded-full"></div>
                            <span className="font-bold text-gray-300">Alice_in_Feedland</span>
                        </div>
                        <Icon name="more-horizontal" className="text-gray-500" />
                    </div>

                    {/* Main Post Area */}
                    <div className="flex-1 flex flex-col relative bg-black">
                        {/* Score Header */}
                        <div className="flex flex-col items-center py-6 z-10 bg-gradient-to-b from-black to-transparent">
                                <h1 className="text-7xl font-['Griffy'] text-[#FF148A] drop-shadow-[0_0_10px_rgba(255,20,138,0.7)] animate-bounce">{score.toLocaleString()}</h1>
                                <p className="text-pink-700 font-['ZenSerif'] font-bold tracking-widest">ADDICTION LEVEL</p>
                        </div>

                        {/* Main Click Area */}
                        <div className="flex-1 flex items-center justify-center relative">
                            {/* Heart Button - Darker, creepier color */}
                            <button 
                                onClick={handleClick}
                                className="w-56 h-56 text-pink-800 transition-transform active:scale-90 hover:scale-105 animate-heart-beat filter drop-shadow-[0_0_20px_rgba(255,20,138,0.3)]"
                            >
                                <svg viewBox="0 0 24 24" fill="currentColor" className="w-full h-full">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                            </button>

                            {/* Floating Texts - Griffy font, Neon Pink */}
                            {floatingTexts.map(ft => (
                                <div 
                                    key={ft.id}
                                    className="absolute text-6xl font-['Griffy'] text-[#FF148A] pointer-events-none animate-float-text drop-shadow-[0_0_5px_rgba(0,0,0,0.8)]"
                                    style={{ left: ft.x, top: ft.y }}
                                >
                                    {ft.text}
                                </div>
                            ))}
                        </div>

                         {/* Fake SNS Action Bar */}
                        <div className="w-full bg-gray-800 p-3 flex gap-4 text-gray-400 z-10 border-t border-gray-700">
                            <Icon name="heart" className="text-[#FF148A]" fill="#FF148A" />
                            <Icon name="message-circle" />
                            <Icon name="send" />
                            <div className="flex-1"></div>
                            <Icon name="bookmark" />
                        </div>
                    </div>

                    {/* Upgrade Shop - Dark Market style */}
                    <div className="bg-gray-900/95 backdrop-blur-md rounded-t-3xl p-6 h-[40%] overflow-y-auto z-20 border-t-4 border-pink-900 shadow-[0_-5px_20px_rgba(0,0,0,0.8)]">
                        <h3 className="font-['Griffy'] text-3xl text-[#FF148A] mb-4 text-center tracking-wider drop-shadow-sm">Dark Market</h3>
                        <div className="space-y-3">
                            {upgrades.map(u => (
                                <button 
                                    key={u.id}
                                    onClick={() => buyUpgrade(u)}
                                    disabled={score < u.cost}
                                    className={`w-full flex justify-between items-center p-4 rounded-xl border font-['ZenSerif'] transition-all ${
                                        score >= u.cost 
                                        ? 'bg-gray-800 border-pink-600 text-pink-400 hover:bg-gray-700 hover:border-pink-400 shadow-[0_0_10px_rgba(255,20,138,0.2)]' 
                                        : 'bg-gray-950 border-gray-800 text-gray-700 cursor-not-allowed opacity-70'
                                    }`}
                                >
                                    <div className="text-left">
                                        <div className="font-bold text-lg">{u.name}</div>
                                        <div className="text-xs opacity-80">+{u.power} {u.type === 'auto' ? '/sec' : 'Click'}</div>
                                    </div>
                                    <div className="font-bold font-['Griffy'] text-xl">â™¥ {u.cost}</div>
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Entry Dialogue */}
                    {showEntryDialogue && (
                        <>
                            <AlicePortrait faceId={1} visible={true} />
                            <DialogueBox text="ì•„ë¬´ ìƒê° ì—†ì´ ëˆ„ë¥´ê¸°ë§Œ í•˜ë©´ ë¼. ì´ê²Œ íë§ì´ì§€..." onClick={() => setShowEntryDialogue(false)} />
                        </>
                    )}
                </div>
            );
        };

        /* =========================================
           [SCENE 5] ENDING: Low Battery & Visual Novel
           ========================================= */
        const EndingScene = ({ onRestart }) => {
            const [step, setStep] = useState('warning'); 
            const [textIndex, setTextIndex] = useState(0);
            const plugSound = useRef(new Audio('./plug.mp3'));
            
            const texts = [
                "ì–´ë¼...",
                "í™”ë©´ì´ ì™œ ì´ë˜? ê°‘ìê¸° ì–´ë‘ì›Œì¡Œì–´.",
                "ë°°í„°ë¦¬ê°€...",
                "1%ë°–ì— ì•ˆ ë‚¨ì•˜ë„¤.",
                "ë²Œì¨ ìƒˆë²½ 3ì‹œê°€ ë„˜ì—ˆêµ¬ë‚˜.",
                "ì‹œê°„ì´ ì´ë ‡ê²Œ ëœ ì¤„ë„ ëª°ëì–´.",
                "ëˆˆì´ ë„ˆë¬´ ë»‘ë»‘í•˜ê³  ì•„íŒŒ.",
                "ë¨¸ë¦¬ë„ ë©í•˜ê³ ...",
                "ì´ì œ ê·¸ë§Œ ìì•¼ê² ì§€?",
                "ë‚´ì¼ í•™êµë„ ê°€ì•¼ í•˜ëŠ”ë°...",
                "...í•˜ì§€ë§Œ",
                "ì¡°ê¸ˆë§Œ ë” ë³´ë©´ ì•ˆ ë ê¹Œ?",
                "ì•„ì§ ëª» ë³¸ ì‡¼ì¸ ê°€ ë„ˆë¬´ ë§ì€ë°.",
                "ìƒˆë¡œ ì˜¬ë¼ì˜¨ ë°ˆë„ í™•ì¸í•´ì•¼ í•˜ê³ ...",
                "ì•„ëƒ, ì¶©ì „ê¸°ë¥¼ ê½‚ê³  ìì•¼ì§€.",
                "ì¶©ì „ê¸°ê°€ ì–´ë”” ìˆì—ˆë”ë¼...",
                "(ì¶©ì „ê¸°ë¥¼ ì°¾ëŠ”ë‹¤)",
                "ì—¬ê¸° ìˆë„¤.",
                "ì´ê±¸ ê½‚ìœ¼ë©´... ê³„ì† ë³¼ ìˆ˜ ìˆì–´.",
                "ì•„ë‹ˆë©´ ê·¸ëƒ¥ ìë²„ë¦´ê¹Œ?",
                "ë„ˆë¬´ í”¼ê³¤í•œë°...",
                "í•˜ì§€ë§Œ...",
                "...ì•„ë‹ˆë©´ ì¡°ê¸ˆë§Œ ë” ë³¼ê¹Œ?" 
            ];
            const [extraTexts, setExtraTexts] = useState([]);
            const [showFinalChoice, setShowFinalChoice] = useState(false);

            useEffect(() => {
                if (step === 'warning') { const timer = setTimeout(() => setStep('scene'), 3000); return () => clearTimeout(timer); }
            }, [step]);

            const handleNextText = () => { 
                if (extraTexts.length > 0) {
                    const nextExtra = extraTexts.slice(1);
                    if (nextExtra.length > 0) {
                        setExtraTexts(nextExtra);
                    } else {
                        setExtraTexts([]); 
                        setShowFinalChoice(true);
                        setStep('choice');
                    }
                    return;
                }
                // ì¶©ì „ ì¸í„°ë™ì…˜ ë¡œì§
                if (textIndex === texts.length - 6) { 
                    setStep('charge');
                    setTextIndex(textIndex + 1);
                } else if (textIndex < texts.length - 1) {
                    setTextIndex(textIndex + 1);
                } else {
                    setStep('choice');
                }
            };

            // ì¶©ì „ ì¸í„°ë™ì…˜ í•¸ë“¤ëŸ¬
            const handleChargeClick = () => {
                plugSound.current.currentTime = 0;
                plugSound.current.play().catch(() => {});
                setStep('click'); 
                setTimeout(() => {
                    setStep('scene'); 
                    handleNextText(); 
                }, 1500); 
            };

            const handleRefuseSleep = () => {
                setStep('scene'); 
                setExtraTexts(["ì•„ë‹ˆ...", "ì—­ì‹œ ì ì´ ì•ˆ ì™€.", "ì¡°ê¸ˆë§Œ ë” ë³¼ê¹Œ?"]);
            };

            const currentText = extraTexts.length > 0 ? extraTexts[0] : texts[textIndex];

            // ì—”ë”© ì”¬ì—ì„œ ì–¼êµ´ ê²°ì • (2ë²ˆ: ì¡¸ë¦¼, 3ë²ˆ: ì¤‘ë…)
            const currentFaceId = (step === 'choice' && showFinalChoice) ? 3 : 2;

            return (
                <div className="relative w-full h-full bg-[#111] overflow-hidden cursor-none" onClick={(step === 'scene' || step === 'charge') ? (step === 'charge' ? handleChargeClick : handleNextText) : undefined}>
                    {step === 'warning' && (
                        <div className="absolute inset-0 z-50 bg-black flex flex-col items-center justify-center animate-pulse">
                            <Icon name="battery-warning" size={64} className="text-red-500 mb-4" />
                            <h1 className="text-red-500 text-4xl tracking-widest font-[Griffy]">LOW BATTERY</h1>
                            <p className="text-red-500/50 mt-2 font-[Griffy]">1% remaining...</p>
                        </div>
                    )}

                    {/* ì¶©ì „ ì¸í„°ë™ì…˜ ì´ë¯¸ì§€ */}
                    {step === 'charge' && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center bg-black">
                            <img src="./charge1.webp" alt="charger" className="w-full h-full object-contain" />
                        </div>
                    )}
                    {step === 'click' && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center bg-black">
                            <img src="./charge2.webp" alt="charging" className="w-full h-full object-contain animate-pulse" />
                        </div>
                    )}

                    <div className={`absolute inset-0 transition-opacity duration-1000 ${(step === 'warning' || step === 'charge' || step === 'click') ? 'opacity-0' : 'opacity-100'}`}>
                        <div className="absolute inset-0 opacity-10 bg-[url('https://www.transparenttextures.com/patterns/sketch-header.png')] bg-repeat"></div>
                        <div className="absolute top-4 right-4 flex items-center gap-2 z-10"><span className="text-red-500 text-xl font-bold animate-pulse font-[Griffy]">1%</span><div className="w-6 h-3 border border-red-500 flex p-[1px]"><div className="w-[10%] h-full bg-red-500"></div></div></div>
                        
                        <AlicePortrait faceId={currentFaceId} visible={true} />
                        <DialogueBox text={currentText} onClick={(step === 'scene' || step === 'charge') ? (step === 'charge' ? handleChargeClick : handleNextText) : undefined} />
                    </div>

                    {step === 'choice' && !showFinalChoice && extraTexts.length === 0 && (
                        <div className="absolute inset-0 bg-black/60 backdrop-blur-sm z-50 flex flex-col items-center justify-center gap-4 animate-in fade-in">
                            <button className="w-64 py-4 bg-gray-800 border border-gray-600 text-gray-300 rounded-xl flex items-center justify-center gap-2 hover:bg-gray-700 font-['ZenSerif']" onClick={handleRefuseSleep}>
                                <Icon name="moon" size={24} /><span className="text-2xl">ì´ì œ ê·¸ë§Œ ì”ë‹¤</span>
                            </button>
                            <button className="w-64 py-4 bg-pink-600 border border-pink-400 text-white rounded-xl shadow-[0_0_20px_rgba(236,72,153,0.5)] flex items-center justify-center gap-2 hover:scale-105 transition-transform font-['ZenSerif']" onClick={onRestart}>
                                <Icon name="refresh-cw" size={24} className="animate-spin-slow" /><span className="text-2xl">ì¡°ê¸ˆë§Œ ë” ë³¼ê¹Œ...?</span>
                            </button>
                        </div>
                    )}

                    {step === 'choice' && showFinalChoice && (
                        <div className="absolute inset-0 bg-black/60 backdrop-blur-sm z-50 flex flex-col items-center justify-center gap-4 animate-in fade-in">
                            <button className="w-64 py-4 bg-pink-600 border border-pink-400 text-white rounded-xl shadow-[0_0_20px_rgba(236,72,153,0.5)] flex items-center justify-center gap-2 hover:scale-105 transition-transform animate-pulse font-['ZenSerif']" onClick={onRestart}>
                                <Icon name="refresh-cw" size={24} className="animate-spin-slow" /><span className="text-2xl">ì¡°ê¸ˆë§Œ ë” ë³¼ê¹Œ...?</span>
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        /* =========================================
           [MAIN APP]
           ========================================= */
        const ModernAliceApp = () => {
            const [currentScene, setCurrentScene] = useState('intro'); 
            const [visitedRooms, setVisitedRooms] = useState(new Set()); 
            const [transitionData, setTransitionData] = useState(null); // [ì¶”ê°€] ë¡œë”© í™”ë©´ ë°ì´í„°
            const bgmRef = useRef(null); // [ì¶”ê°€] BGM Ref

            // [ì¶”ê°€] BGM ì´ˆê¸°í™”
            useEffect(() => {
                bgmRef.current = new Audio('./8bit_1.mp3');
                bgmRef.current.loop = true;
                bgmRef.current.volume = 0.5;
            }, []);

            // [ì¶”ê°€] ì”¬ ë³€ê²½ì— ë”°ë¥¸ BGM ì œì–´
            useEffect(() => {
                if (!bgmRef.current) return;
                
                // ì‡¼ì¸  ë°©ì—ì„œëŠ” ì¼ì‹œì •ì§€, ê·¸ ì™¸(ì¸íŠ¸ë¡œ ì œì™¸)ì—ëŠ” ì¬ìƒ
                if (currentScene === 'shorts') {
                    bgmRef.current.pause();
                } else if (currentScene !== 'intro') {
                    // ì‚¬ìš©ìê°€ ì‹œì‘ ë²„íŠ¼ì„ ëˆ„ë¥¸ í›„(ì¸íŠ¸ë¡œ ì•„ë‹˜)ì—ëŠ” ê³„ì† ì¬ìƒ
                    bgmRef.current.play().catch(e => console.log("BGM Play Error (Interaction needed)"));
                }
            }, [currentScene]);

            const handleStartMusic = () => {
                if (bgmRef.current) {
                    bgmRef.current.play().catch(e => console.log("Start Click Play Error"));
                }
            };

            const handleRoomSelect = (room) => {
                const newVisited = new Set(visitedRooms); newVisited.add(room); setVisitedRooms(newVisited);
                // [ìˆ˜ì •] ì¦‰ì‹œ ì´ë™í•˜ì§€ ì•Šê³  ë¡œë”© í™”ë©´ í‘œì‹œ
                setTransitionData(ROOM_INFO[room]);
                
                // 2.5ì´ˆ í›„ ì‹¤ì œ ì´ë™
                setTimeout(() => {
                    setTransitionData(null);
                    setCurrentScene(room);
                }, 2500);
            };

            const handleBackToHub = () => {
                if (visitedRooms.size >= 4) setCurrentScene('ending'); else setCurrentScene('hub');
            };
            const handleRestart = () => { setVisitedRooms(new Set()); setCurrentScene('intro'); };

            const renderScene = () => {
                switch (currentScene) {
                    case 'intro': return <IntroScene onNext={() => setCurrentScene('hub')} onStartMusic={handleStartMusic} />;
                    case 'hub': return <HubScene onSelectRoom={handleRoomSelect} visitedRooms={visitedRooms} />;
                    case 'shorts': return <ShortsRoom />;
                    case 'meme': return <MemeRoom />;
                    case 'shopping': return <ShoppingRoulette />;
                    case 'clicker': return <ClickerRoom />; // [NEW]
                    case 'ending': return <EndingScene onRestart={handleRestart} />;
                    default: return <IntroScene onNext={() => setCurrentScene('hub')} />;
                }
            };

            const isIntro = currentScene === 'intro';
            const containerClass = isIntro 
                ? "relative w-full h-full flex items-center justify-center overflow-hidden" 
                : "relative w-full max-w-md h-[100dvh] max-h-[900px] overflow-hidden bg-black shadow-2xl rounded-none sm:rounded-3xl border-0 sm:border-8 border-gray-900";

            // [ìˆ˜ì •] currentSceneì— ë”°ë¼ ë°°ê²½ ì´ë¯¸ì§€ ë™ì  ë³€ê²½
            const isReality = currentScene === 'intro' || currentScene === 'ending';
            const backgroundImage = isReality ? "url('./bg_global.webp')" : "url('./bg_2.webp')";

            return (
                <div 
                    className={`flex justify-center items-center min-h-screen font-sans selection:bg-pink-500 selection:text-white`}
                    style={{
                        backgroundImage: backgroundImage, // [ìˆ˜ì •] ë™ì  ë°°ê²½ ì´ë¯¸ì§€ ì ìš©
                        backgroundSize: "cover",
                        backgroundPosition: "center"
                    }}
                >
                    <CustomCursor visible={currentScene === 'shorts'} />
                    
                    <div className={containerClass}>
                        {/* [ì¶”ê°€] ë¡œë”© ì¤‘ì´ë©´ ë¡œë”© í™”ë©´, ì•„ë‹ˆë©´ ì”¬ ë Œë”ë§ */}
                        {transitionData ? (
                            <div className="absolute inset-0 z-50 bg-black flex flex-col items-center justify-center animate-in fade-in">
                                {/* [ìˆ˜ì •] í…Œë‘ë¦¬ ì œê±°, ì•„ì´ì½˜ë§Œ ë‘¥ì‹¤ë‘¥ì‹¤(animate-float) + í¬ê¸° í‚¤ì›€(w-64ë¡œ ë” í‚¤ì›€) */}
                                <div className="w-64 h-64 flex items-center justify-center animate-float">
                                    <img 
                                        src={transitionData.img} 
                                        className="w-full h-full object-contain drop-shadow-[0_0_30px_rgba(255,255,255,0.5)]" 
                                        alt="icon"
                                    />
                                </div>
                                {/* [ìˆ˜ì •] í°íŠ¸ ì»¬ëŸ¬ #FF148A, í¬ê¸° ì¶•ì†Œ(text-xl) */}
                                <p className="text-[#FF148A] text-xl mt-12 font-['ZenSerif'] animate-pulse tracking-widest text-center px-4 leading-relaxed z-10">
                                    {transitionData.text}
                                </p>
                            </div>
                        ) : (
                            renderScene()
                        )}
                        
                        {/* ë’¤ë¡œê°€ê¸° ë²„íŠ¼ */}
                        {['shorts', 'meme', 'shopping', 'clicker'].includes(currentScene) && !transitionData && (
                            <button onClick={handleBackToHub} className="absolute top-4 left-4 z-50 w-10 h-10 bg-black/50 backdrop-blur-md rounded-full flex items-center justify-center text-white border border-white/20 hover:bg-white hover:text-black transition-all">
                                <Icon name="arrow-left" size={20} />
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ModernAliceApp />);
    </script>
</body>
</html>
